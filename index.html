<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Aura X-System | Secret Tech</title>
<style>
    @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@100;400;800&display=swap');
    
    body { margin:0; background:#000; overflow:hidden; font-family: 'JetBrains Mono', monospace; }
    #video { position: absolute; opacity: 0; pointer-events: none; }
    canvas { position:absolute; width:100vw; height:100vh; object-fit:cover; display: none; }

    /* شاشة الاختراق البصري */
    #overlay {
        position: fixed; top:0; left:0; width:100%; height:100%;
        background:#000; z-index: 9999; display: flex;
        flex-direction: column; align-items: center; justify-content: center;
        transition: 1s;
    }
    #start-btn {
        padding: 25px 60px; background: none; color: #00e5ff;
        border: 1px solid #00e5ff; border-radius: 5px; font-weight: 800;
        font-size: 16px; cursor: pointer; letter-spacing: 5px;
        box-shadow: 0 0 20px rgba(0, 229, 255, 0.2); transition: 0.3s;
    }
    #start-btn:hover { background: #00e5ff; color: #000; box-shadow: 0 0 50px #00e5ff; }

    /* واجهة التحكم العسكرية */
    #ui {
        position:fixed; bottom:50px; left:50%; transform:translateX(-50%);
        display:none; gap:15px; z-index: 1000; align-items: center;
        padding: 20px; border-radius: 100px; background: rgba(0,0,0,0.8);
        border: 1px solid rgba(0,229,255,0.2); backdrop-filter: blur(20px);
    }
    button {
        width: 50px; height: 50px; border-radius: 50%;
        border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); 
        color: #00e5ff; font-size: 10px; cursor: pointer; transition: 0.3s;
    }
    button.active { background: #00e5ff; color: #000; box-shadow: 0 0 20px #00e5ff; }
    
    #rec-btn { width: 80px; height: 80px; background: none; border: 2px solid #ff004c; position: relative; }
    #rec-btn::after { content:''; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:60px; height:60px; background:#ff004c; border-radius:50%; transition: 0.3s; }
    #rec-btn.recording::after { width: 30px; height: 30px; border-radius: 5px; animation: pulse 1s infinite; }

    /* بيانات الميتا الحية */
    #meta {
        position: fixed; top: 20px; left: 20px; color: #00e5ff; font-size: 8px;
        line-height: 1.5; pointer-events: none; z-index: 1001; text-transform: uppercase;
    }
</style>
</head>
<body>

<div id="overlay">
    <div id="loading-text" style="color:#00e5ff; margin-bottom:20px; font-size:10px; letter-spacing:10px;">INITIALIZING X-CORE</div>
    <button id="start-btn" onclick="startSystem()">ACTIVATE SYSTEM</button>
</div>

<div id="meta">
    SYSTEM: ACTIVE<br>
    CODEC: VP9 RAW<br>
    FPS: 24.000<br>
    BITRATE: 20.0MBPS<br>
    ENCRYPTION: AES-256
</div>

<video id="video" autoplay playsinline muted></video>
<canvas id="canvas"></canvas>

<div id="ui">
    <button onclick="setStyle('QUANTUM', this)" class="active">QNTM</button>
    <button onclick="setStyle('MATRIX', this)">MTRX</button>
    <button id="rec-btn" onclick="toggleRecord()"></button>
    <button onclick="toggleFlare(this)">FLARE</button>
    <button onclick="stealthMode()">STEALTH</button>
</div>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d", { desynchronized: true, alpha: false });

let styleMode = "QUANTUM";
let flareOn = false;
let mediaRecorder;
let recordedChunks = [];
let flarePos = { x: 0, y: 0 };

async function startSystem() {
    try {
        const stream = await navigator.mediaDevices.getUserMedia({
            video: { facingMode: "user", width: { ideal: 3840 }, height: { ideal: 2160 }, frameRate: 24 },
            audio: { echoCancellation: false, noiseSuppression: false, autoGainControl: false } 
        });
        video.srcObject = stream;
        video.onloadedmetadata = () => {
            video.play();
            document.getElementById('overlay').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('overlay').style.display = 'none';
                document.getElementById('ui').style.display = 'flex';
                canvas.style.display = 'block';
                render();
            }, 1000);
        };
    } catch (err) { alert("SYSTEM REJECTED: Grant Camera Permissions."); }
}

function setStyle(mode, btn) {
    styleMode = mode;
    document.querySelectorAll('#ui button').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
}

function toggleFlare(btn) { flareOn = !flareOn; btn.classList.toggle('active'); }

function stealthMode() {
    document.getElementById('ui').style.opacity = '0';
    document.getElementById('meta').style.opacity = '0';
}

// إعادة النظام بلمسة سرية (ثلاث لمسات سريعة)
let clickCount = 0;
window.addEventListener('touchstart', () => {
    clickCount++;
    if(clickCount >= 3) {
        document.getElementById('ui').style.opacity = '1';
        document.getElementById('meta').style.opacity = '1';
        clickCount = 0;
    }
    setTimeout(() => clickCount = 0, 1000);
});

function render() {
    if (video.readyState >= 2) {
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;

        // خوارزمية المعالجة البصرية (Neural Logic)
        if(styleMode === "QUANTUM") {
            ctx.filter = "contrast(1.2) saturate(1.4) brightness(0.9) hue-rotate(-5deg)";
        } else if(styleMode === "MATRIX") {
            ctx.filter = "contrast(1.5) grayscale(1) brightness(0.8)";
        }
        
        ctx.drawImage(video, 0, 0);

        // تتبع الضوء لرسم الوهج (Flare Tracking)
        if(flareOn) {
            analyzeHighlights();
            drawFlare();
        }

        // قناع السينما العالمي (2.39:1 Aspect Ratio)
        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, canvas.width, canvas.height * 0.13);
        ctx.fillRect(0, canvas.height * 0.87, canvas.width, canvas.height * 0.13);
    }
    requestAnimationFrame(render);
}

function analyzeHighlights() {
    // تحليل نقطي سريع لأكثر منطقة مضيئة
    const tempCanvas = document.createElement('canvas');
    const tCtx = tempCanvas.getContext('2d');
    tempCanvas.width = 50; tempCanvas.height = 50;
    tCtx.drawImage(video, 0, 0, 50, 50);
    const data = tCtx.getImageData(0,0,50,50).data;
    let maxL = 0;
    for(let i=0; i<data.length; i+=4) {
        let l = data[i] + data[i+1] + data[i+2];
        if(l > maxL) {
            maxL = l;
            flarePos.x = (i/4 % 50) * (canvas.width/50);
            flarePos.y = Math.floor(i/4 / 50) * (canvas.height/50);
        }
    }
}

function drawFlare() {
    ctx.globalCompositeOperation = "screen";
    let g = ctx.createLinearGradient(0, flarePos.y, canvas.width, flarePos.y);
    g.addColorStop(0, "transparent");
    g.addColorStop(0.5, "rgba(0, 229, 255, 0.4)");
    g.addColorStop(1, "transparent");
    ctx.fillStyle = g;
    ctx.fillRect(0, flarePos.y - 1, canvas.width, 3);
    
    // وهج مركزي
    let rg = ctx.createRadialGradient(flarePos.x, flarePos.y, 0, flarePos.x, flarePos.y, 100);
    rg.addColorStop(0, "rgba(0, 229, 255, 0.3)");
    rg.addColorStop(1, "transparent");
    ctx.fillStyle = rg;
    ctx.fillRect(flarePos.x-100, flarePos.y-100, 200, 200);
    
    ctx.globalCompositeOperation = "source-over";
}

function toggleRecord() {
    const btn = document.getElementById("rec-btn");
    if(!mediaRecorder) {
        recordedChunks = [];
        const stream = canvas.captureStream(24);
        const audio = video.srcObject.getAudioTracks()[0];
        if(audio) stream.addTrack(audio);

        const options = { 
            mimeType: 'video/webm;codecs=vp9', 
            videoBitsPerSecond: 20000000 // 20Mbps - جودة خارقة
        };

        mediaRecorder = new MediaRecorder(stream, options);
        mediaRecorder.ondataavailable = e => recordedChunks.push(e.data);
        mediaRecorder.onstop = () => {
            const blob = new Blob(recordedChunks, { type: "video/webm" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url; a.download = `X_CORE_RAW_${Date.now()}.webm`; a.click();
        };

        mediaRecorder.start();
        btn.classList.add("recording");
    } else {
        mediaRecorder.stop();
        mediaRecorder = null;
        btn.classList.remove("recording");
    }
}
</script>
</body>
</html>