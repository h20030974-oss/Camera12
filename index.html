<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Aura System X | The Final Secret</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;800&display=swap');
        
        body { margin: 0; background: #000; overflow: hidden; font-family: 'JetBrains Mono', monospace; }
        #video { position: absolute; width: 1px; height: 1px; opacity: 0; }
        canvas { position: absolute; width: 100vw; height: 100vh; object-fit: cover; cursor: crosshair; }

        /* نظام الإقلاع البصري */
        #boot-loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 10000; display: flex;
            flex-direction: column; align-items: center; justify-content: center;
            transition: 1s ease-in-out;
        }
        .core-btn {
            padding: 25px 60px; background: none; color: #fff;
            border: 1px solid #333; border-radius: 5px; font-weight: 800;
            font-size: 14px; cursor: pointer; letter-spacing: 5px; transition: 0.4s;
        }
        .core-btn:hover { background: #fff; color: #000; box-shadow: 0 0 50px #fff; border-color: #fff; }

        /* واجهة التحكم العسكرية المخفية */
        #ui {
            position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%);
            display: none; gap: 15px; z-index: 1000; align-items: center;
            background: rgba(0,0,0,0.6); padding: 15px 30px; border-radius: 100px;
            backdrop-filter: blur(25px); border: 1px solid rgba(255,255,255,0.05);
            transition: 0.5s opacity;
        }
        button {
            width: 45px; height: 45px; border-radius: 50%;
            border: 1px solid rgba(255,255,255,0.1); background: none; 
            color: #fff; font-size: 9px; cursor: pointer; transition: 0.3s;
        }
        button.active { background: #fff; color: #000; font-weight: 800; }
        
        #shutter {
            width: 70px; height: 70px; border: 4px solid #fff; border-radius: 50%;
            position: relative; transition: 0.4s;
        }
        #shutter::after {
            content: ''; position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%); width: 50px; height: 50px;
            background: #ff003c; border-radius: 50%; transition: 0.3s;
        }
        #shutter.rec::after { width: 30px; height: 30px; border-radius: 8px; animation: pulse 1s infinite; }

        /* شريط المعلومات التكنولوجية */
        #status-bar {
            position: fixed; top: 25px; width: 100%; display: none;
            justify-content: center; gap: 30px; color: #fff; font-size: 8px;
            letter-spacing: 3px; z-index: 1000; opacity: 0.5;
        }

        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
    </style>
</head>
<body>

<!-- محرك المعالجة البصرية (SVG Hardware Neural Filters) -->
<svg style="display:none;">
    <filter id="aura-neural-sharp">
        <feConvolveMatrix order="3" preserveAlpha="true" kernelMatrix="0 -1 0 -1 5 -1 0 -1 0"/>
        <feColorMatrix type="matrix" values="1.05 0 0 0 0.01  0 1.05 0 0 0.01  0 0 1.1 0 0.02  0 0 0 1 0" />
    </filter>
</svg>

<div id="boot-loader">
    <div style="font-size: 10px; color: #444; margin-bottom: 20px; letter-spacing: 8px;">AURA SYSTEM X ONLINE</div>
    <button class="core-btn" onclick="initializeSystem()">BOOT ENGINE</button>
</div>

<div id="status-bar">
    <span>48MP SENSOR ACTIVE</span>
    <span id="fps-counter">FPS: 24.00</span>
    <span style="color:#ffdf00">MASTER RAW</span>
</div>

<video id="video" autoplay playsinline muted></video>
<canvas id="canvas"></canvas>

<div id="ui">
    <button onclick="setEngineMode('MASTER', this)" class="active">MST</button>
    <button onclick="setEngineMode('LOG', this)">LOG</button>
    <div id="shutter" onclick="handleShutter()"></div>
    <button onclick="toggleFlare(this)">FLR</button>
    <button onclick="stealthMode()">HUD</button>
</div>

<script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d', { alpha: false, desynchronized: true });
    
    let engineMode = 'MASTER';
    let flareActive = false;
    let mediaRecorder;
    let recordedChunks = [];
    let isRecording = false;

    async function initializeSystem() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({
                video: {
                    facingMode: "environment",
                    width: { ideal: 1920 },
                    height: { ideal: 1080 },
                    frameRate: { ideal: 24 }
                },
                audio: { echoCancellation: false, noiseSuppression: false }
            });
            
            video.srcObject = stream;
            video.onloadedmetadata = () => {
                video.play();
                document.getElementById('boot-loader').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('boot-loader').style.display = 'none';
                    document.getElementById('ui').style.display = 'flex';
                    document.getElementById('status-bar').style.display = 'flex';
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    startAuraEngine();
                }, 1000);
            };
        } catch (err) {
            alert("SYSTEM ERROR: PLEASE GRANT CAMERA ACCESS");
        }
    }

    function setEngineMode(mode, btn) {
        engineMode = mode;
        document.querySelectorAll('button').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }

    function toggleFlare(btn) {
        flareActive = !flareActive;
        btn.classList.toggle('active');
    }

    function stealthMode() {
        const ui = document.getElementById('ui');
        const bar = document.getElementById('status-bar');
        const currentOp = ui.style.opacity || "1";
        ui.style.opacity = currentOp === "1" ? "0" : "1";
        bar.style.opacity = currentOp === "1" ? "0" : "0.5";
    }

    // السر: لمس وسط الشاشة مطولاً يعيد الواجهة
    window.addEventListener('touchstart', (e) => {
        if(e.touches.length === 1) {
            this.timer = setTimeout(() => {
                document.getElementById('ui').style.opacity = '1';
                document.getElementById('status-bar').style.opacity = '0.5';
            }, 1500);
        }
    });
    window.addEventListener('touchend', () => clearTimeout(this.timer));

    function startAuraEngine() {
        // تطبيق الفلتر العصبي (Neural Filter)
        if (engineMode === 'MASTER') {
            ctx.filter = 'url(#aura-neural-sharp) contrast(1.1) brightness(0.98)';
        } else if (engineMode === 'LOG') {
            ctx.filter = 'contrast(0.7) saturate(0.8) brightness(1.1)';
        } else {
            ctx.filter = 'none';
        }

        // رسم الإطار الأساسي
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

        // إضافة تأثير الوهج الأزرق (Anamorphic Flare)
        if (flareActive) {
            ctx.globalCompositeOperation = 'screen';
            const gradient = ctx.createLinearGradient(0, canvas.height / 2, canvas.width, canvas.height / 2);
            gradient.addColorStop(0, 'rgba(0,0,0,0)');
            gradient.addColorStop(0.5, 'rgba(0, 180, 255, 0.25)');
            gradient.addColorStop(1, 'rgba(0,0,0,0)');
            ctx.fillStyle = gradient;
            const drift = Math.sin(Date.now() / 1000) * 5; // حركة خفيفة جداً
            ctx.fillRect(0, (canvas.height / 2) + drift, canvas.width, 2.5);
            ctx.globalCompositeOperation = 'source-over';
        }

        // قناع السينما الاحترافي
        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, canvas.width, canvas.height * 0.12);
        ctx.fillRect(0, canvas.height * 0.88, canvas.width, canvas.height * 0.12);

        requestAnimationFrame(startAuraEngine);
    }

    function handleShutter() {
        const shutter = document.getElementById('shutter');
        if (!isRecording) {
            startRecording();
            shutter.classList.add('rec');
            isRecording = true;
        } else {
            stopRecording();
            shutter.classList.remove('rec');
            isRecording = false;
        }
    }

    function startRecording() {
        recordedChunks = [];
        const stream = canvas.captureStream(24);
        const audioTracks = video.srcObject.getAudioTracks();
        if (audioTracks.length > 0) stream.addTrack(audioTracks[0]);

        mediaRecorder = new MediaRecorder(stream, {
            mimeType: 'video/webm;codecs=vp9',
            videoBitsPerSecond: 20000000 // 20 ميجا بايت في الثانية (جودة فائقة)
        });

        mediaRecorder.ondataavailable = (e) => { if (e.data.size > 0) recordedChunks.push(e.data); };
        mediaRecorder.onstop = () => {
            const blob = new Blob(recordedChunks, { type: 'video/webm' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `AURA_X_SHOT_${Date.now()}.webm`;
            a.click();
        };
        mediaRecorder.start();
    }

    function stopRecording() {
        mediaRecorder.stop();
    }
</script>
</body>
</html>